name: dotnet pipeline

on:
  push:
    branches:
      - cicd
  pull_request:
    branches:
      - cicd

jobs:
  build-and-test:
    runs-on: self-hosted

    steps:
      # Checkout the code
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set Environment Variables
        run: echo "HOME=/root/actions-runner" >> $GITHUB_ENV

      # Restore dependencies
      - name: Restore dependencies
        run: dotnet restore 9.0/BlazorSample_BlazorWebApp

      # Build and publish the Blazor application
      - name: Build and Publish
        run: dotnet publish 9.0/BlazorSample_BlazorWebApp -c Release -o /var/www/blazorsample

      - name: Restart Application Service
        run: |
          sudo systemctl restart blazorsample.service

